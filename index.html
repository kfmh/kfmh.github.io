<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./styling/style.css">
    <link rel="icon" type="image/x-icon" href="./src/icons/lightning.png">
    <title>kfmh</title>
</head>
<style>
    .days {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        padding: 0 30px 0 0;
    }
    .years {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        padding: 0 30px 0 0;
    }
</style>
<body>   
    <header >
        <!-- <img class="profile-pic" src="./src/Style/profile_IMG.png" alt=""> -->
        <div class="title">
            <h1 class="pagetitle" >Karl-Fredrik M. Hagman</h1>
            <h3 class="subtitle" >Data Scientist</h3>
        </div>
        <div class="links">
            <a href="https://github.com/kfmh">
                <img src="./src/icons/b_github.png" alt="">
                <p>Github</p>
            </a>
            <a href="https://www.linkedin.com/in/karl-fredrik-hagman-58a748225/">
                <img src="./src/icons/b_linkedin.png" alt="">
                <p>Linkedin</p>
            </a>
            <a href="https://www.youtube.com/@UndrWolf">
                <img src="./src/icons/b_youtube2.png" alt="">
                <p>Youtube</p>
            </a>
            <a href="/more.html">
                <img src="./src/icons/b_document.png" alt="">
                <p>More</p>
            </a>
        </div>
    
    </header>

    <main>
        <div id="burgerMenu" class="menu-container">
            <div class="burger-menu">
                <!-- <div></div>
                <div></div>
                <div></div> -->
                <!-- <p>menu</p> -->
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <p>m</p>
                    <p>e</p>
                    <p>n</p>
                    <p>u</p>
                </div>
                <img src="./src/icons/lightning.png" alt="">

            </div>
        </div>
        <div id="logbook_nav" class="logbook_nav">
            <div>
                <h2 id="project_title" >Projects</h2>
                <a target="_blank" href="https://github.com/kfmh/doors">doors</a> <br>
                <a target="_blank" href="https://github.com/kfmh/uw-chess">uw_chess</a> <br>
                <a target="_blank" href="https://github.com/kfmh/uw_realtime_stt">uw_realtime_stt</a> <br>
            </div>
            <h2 id="logbook_title">Logbook</h2>
            <div id="years" class="years"></div>
            <div id="months" class="months"></div>
            <div id="days" class="days"></div>
        </div>

        <article id="logbook_post" class="logbook-post">
            <h2 style="margin: 20px 0 0 0; padding: 0;"><span id="weekday"></span> <span id="date"></span></h2>
            <h4 style="font-weight: 100; margin: 0 0 20px 0; padding: 0;">Project: <span id="project"></span></h4>
            <section>
                <h4>Objective</h4>
                <p id="objective"></p>
            </section>
            <section id="agenda_div" class="hide">
                <h4>Task blocks</h4>
                <p id="agenda"></p>
            </section>
            <div id="media" class="media">
                <img id="image" src="" alt="">
                <iframe id="yt_video" width="560" height="315" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>
            <section>
                <h4>Methods</h4>
                <p id="methods"></p>
            </section>
            <section >
                <h4>Insights</h4>
                <p id="insights"></p>
            </section>
            <section >
                <h4>Conclusions</h4>
                <p id="conclusions"></p>
            </section>
            <div id="logbook_right"></div>
        </article>
        
        <div class="projects"></div>
    </main>


<script>
    let currentSelectedLink = null;

    // Function to populate the agenda section
    function populateAgenda(agendaItems) {
        let agendaSection = document.getElementById('agenda');
        let agenda_div = document.getElementById('agenda_div');
        // Clear existing content
        agendaSection.innerHTML = '';
        let ul = document.createElement('ul');
        agendaItems.forEach(item => {
            let li = document.createElement('li');
            li.textContent = item;
            ul.appendChild(li);
        });
        agendaSection.appendChild(ul);
        
    }

    function f2(year, month, date) {
    fetch('./logbook/logbook.json')
        .then(response => response.json())
        .then(data => {
            let data_json = data[year][month][date];

            // Update the logbook content
            document.getElementById('date').textContent = date;
            document.getElementById('project').textContent = data_json.project;
            document.getElementById('weekday').textContent = data_json.weekday;
            document.getElementById('objective').textContent = data_json.objective;
            document.getElementById('methods').textContent = data_json.methods;
            document.getElementById('insights').textContent = data_json.insights;
            document.getElementById('conclusions').textContent = data_json.conclusions;
            document.getElementById('image').src = data_json.image;
            document.getElementById('image').alt = data_json.alt_text;
            document.getElementById('yt_video').src = data_json.video_url;

            let ytVideo = document.getElementById('yt_video');
            let media = document.getElementById('media');

            // Update media visibility
            if (data_json.video_url === '') {
                ytVideo.classList.add('hide');
                ytVideo.src = '';
                if (data_json.image === '') {
                    media.classList.add('hide');
                }
            } else {
                ytVideo.classList.remove('hide');
                ytVideo.src = data_json.video_url;
            }
            if (data_json.image != '' || data_json.video_url != '') {
                media.classList.remove('hide');
            }

            // Update the agenda section
            if (data_json.agenda.length > 0) {
                agenda_div.classList.remove('hide');
                populateAgenda(data_json.agenda);
            } else {
                agenda_div.classList.add('hide');
            }

            // Highlight the current selected day link
            if (currentSelectedLink) {
                currentSelectedLink.classList.remove('selected');
            }
            let dayLinks = document.getElementById('days').getElementsByTagName('a');
            for (let link of dayLinks) {
                if (link.textContent === date) {
                    link.classList.add('selected');
                    currentSelectedLink = link;
                    break;
                        }
            }
        })
        .catch(error => console.error('Error fetching data:', error));
    }


    function highlightLink(link, type) {
    let currentSelected = document.getElementsByClassName('selected-' + type);
    if (currentSelected.length > 0) {
        currentSelected[0].classList.remove('selected-' + type);
    }
    link.classList.add('selected-' + type);
}

function generateMonthLinks(year, data, monthsDiv, daysDiv, latestMonth) {
    monthsDiv.innerHTML = ''; // Clear existing months
    Object.keys(data[year]).sort().forEach(month => {
        let monthLink = document.createElement('a');
        monthLink.href = '#';
        monthLink.textContent = month;
        monthLink.addEventListener('click', function(event) {
            event.preventDefault();
            generateDayLinks(year, month, data, daysDiv);
            highlightLink(monthLink, 'month');
        });
        monthsDiv.appendChild(monthLink);
        if (month === latestMonth) {
            highlightLink(monthLink, 'month');
        }
    });
}

function generateDayLinks(year, month, data, daysDiv, latestDate) {
    daysDiv.innerHTML = ''; // Clear existing days
    Object.keys(data[year][month]).sort().forEach(date => {
        let dateLink = document.createElement('a');
        dateLink.href = '#';
        dateLink.textContent = date;
        dateLink.addEventListener('click', function(event) {
            event.preventDefault();
            f2(year, month, date);
            highlightLink(dateLink, 'day');
        });
        daysDiv.appendChild(dateLink);
        if (date === latestDate) {
            highlightLink(dateLink, 'day');
        }
    });
}

document.addEventListener('DOMContentLoaded', function() {
    fetch('./logbook/logbook.json')
        .then(response => response.json())
        .then(data => {
            let yearsDiv = document.getElementById('years');
            let monthsDiv = document.getElementById('months');
            let daysDiv = document.getElementById('days');

            let latestYear = Object.keys(data).sort().reverse()[0];
            let latestMonth = Object.keys(data[latestYear]).sort().reverse()[0];
            let latestDate = Object.keys(data[latestYear][latestMonth]).sort().reverse()[0];
            f2(latestYear, latestMonth, latestDate);

            Object.keys(data).forEach(year => {
                let yearLink = document.createElement('a');
                yearLink.href = '#';
                yearLink.textContent = year;
                yearLink.addEventListener('click', function(event) {
                    event.preventDefault();
                    monthsDiv.innerHTML = ''; // Clear months
                    daysDiv.innerHTML = ''; // Clear days
                    highlightLink(yearLink, 'year');
                    generateMonthLinks(year, data, monthsDiv, daysDiv);
                });
                yearsDiv.appendChild(yearLink);
                if(year === latestYear){
                    highlightLink(yearLink, 'year');
                }
            });

            generateMonthLinks(latestYear, data, monthsDiv, daysDiv, latestMonth);
            generateDayLinks(latestYear, latestMonth, data, daysDiv, latestDate);
        })
        .catch(error => console.error('Error fetching data:', error));





        // Burger menu functionality
        const burger = document.getElementById('burgerMenu');
        const nav = document.getElementById('logbook_nav');

        burger.addEventListener('click', function() {
            nav.classList.toggle('is-active');
        });

        // Close nav when clicking outside
        document.addEventListener('click', function(event) {
            if (!nav.contains(event.target) && !burger.contains(event.target)) {
                if (nav.classList.contains('is-active')) {
                    nav.classList.remove('is-active');
                }
            }
        });
    });


</script>
</body>
</html>
